<template>
  <svg width="69.1" height="67.5" viewBox="0 0 69.1 67.5" xmlns="http://www.w3.org/2000/svg"><g visibility="hidden" id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#000" stroke-width="0.25mm" fill="#000" style="stroke:#000;stroke-width:0.25mm;fill:#000"><path id="path-v" d="M 41.4 67.5 L 69.1 0 L 51.8 0 L 34.6 43.6 L 17.3 0 L 0 0 L 27.7 67.5 L 41.4 67.5 Z" vector-effect="non-scaling-stroke"/></g></svg>
  <svg width="70.702" height="69.712" viewBox="0 0 70.702 69.712" xmlns="http://www.w3.org/2000/svg"><g visibility="hidden" id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#000" stroke-width="0.25mm" fill="#000" style="stroke:#000;stroke-width:0.25mm;fill:#000"><path id="path-g" d="M 70.402 30.204 L 33.002 30.204 L 33.002 43.704 L 51.602 43.704 C 48.802 49.804 42.302 53.804 35.402 53.804 A 17.482 17.482 0 0 1 27.164 51.879 A 17.732 17.732 0 0 1 22.502 48.304 A 18.873 18.873 0 0 1 17.302 34.835 A 24.58 24.58 0 0 1 17.302 34.804 A 19.635 19.635 0 0 1 18.767 27.153 A 18.413 18.413 0 0 1 22.602 21.404 A 17.909 17.909 0 0 1 35.536 15.91 A 23.857 23.857 0 0 1 36.102 15.904 A 18.896 18.896 0 0 1 47.337 19.46 A 17.322 17.322 0 0 1 52.502 25.504 L 68.702 19.604 C 65.802 13.504 61.402 8.704 55.502 5.204 C 49.702 1.704 43.202 0.004 36.102 0.004 A 38.755 38.755 0 0 0 22.216 2.414 A 34.392 34.392 0 0 0 10.402 10.004 A 32.919 32.919 0 0 0 0.005 34.339 A 41.693 41.693 0 0 0 0.002 34.804 A 36.149 36.149 0 0 0 2.395 48.15 A 33.436 33.436 0 0 0 10.202 59.804 C 17.102 66.404 25.502 69.704 35.402 69.704 A 36.913 36.913 0 0 0 48.684 67.387 A 33.298 33.298 0 0 0 60.602 59.504 A 34.877 34.877 0 0 0 70.646 35.896 A 46.991 46.991 0 0 0 70.702 34.004 A 2.123 2.123 0 0 0 70.698 33.91 C 70.679 33.612 70.604 32.651 70.474 31.068 A 931.101 931.101 0 0 0 70.402 30.204 Z" vector-effect="non-scaling-stroke"/></g></svg>
  <svg width="63.606" height="67.528" viewBox="0 0 63.606 67.528" xmlns="http://www.w3.org/2000/svg"><g visibility="hidden" id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#000" stroke-width="0.25mm" fill="#000" style="stroke:#000;stroke-width:0.25mm;fill:#000"><path id="path-d" d="M 28 0.012 L 0 0.012 L 0 67.512 L 28 67.512 C 38.1 67.512 46.6 64.312 53.4 57.812 C 60.2 51.312 63.6 43.212 63.6 33.712 C 63.6 24.212 60.2 16.312 53.4 9.812 C 46.6 3.312 38.1 0.012 28 0.012 Z M 28 52.312 L 16.6 52.312 L 16.6 15.312 L 28 15.312 C 33.1 15.312 37.5 17.112 41 20.612 C 44.5 24.112 46.3 28.512 46.3 33.712 C 46.3 38.912 44.5 43.312 41 46.912 C 37.5 50.512 33.2 52.312 28 52.312 Z" vector-effect="non-scaling-stroke"/></g></svg>
  <svg width="68.002" height="69.703" viewBox="0 0 68.002 69.703" xmlns="http://www.w3.org/2000/svg"><g visibility="hidden" id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#000" stroke-width="0.25mm" fill="#000" style="stroke:#000;stroke-width:0.25mm;fill:#000"><path id="path-c" d="M 68.002 50.102 L 51.802 44.202 A 17.738 17.738 0 0 1 36.937 53.759 A 20.589 20.589 0 0 1 35.602 53.802 A 19.031 19.031 0 0 1 29.099 52.732 A 17.306 17.306 0 0 1 22.502 48.402 A 18.829 18.829 0 0 1 17.309 35.369 A 25.259 25.259 0 0 1 17.302 34.802 A 20.869 20.869 0 0 1 18.396 27.909 A 17.734 17.734 0 0 1 22.502 21.302 A 17.262 17.262 0 0 1 34.62 15.923 A 22.611 22.611 0 0 1 35.602 15.902 A 18.622 18.622 0 0 1 44.782 18.224 A 17.717 17.717 0 0 1 51.802 25.502 L 68.002 19.602 C 65.102 13.702 60.802 8.902 55.102 5.402 A 35.158 35.158 0 0 0 37.969 0.067 A 42.885 42.885 0 0 0 35.602 0.002 A 37.786 37.786 0 0 0 22.1 2.336 A 34.511 34.511 0 0 0 10.202 10.002 C 3.402 16.702 0.002 24.902 0.002 34.802 A 35.532 35.532 0 0 0 2.709 48.828 A 33.666 33.666 0 0 0 10.202 59.702 A 34.56 34.56 0 0 0 34.646 69.692 A 45.658 45.658 0 0 0 35.602 69.702 A 38.477 38.477 0 0 0 47.685 67.844 A 35.032 35.032 0 0 0 55.102 64.402 C 60.802 60.802 65.102 56.002 68.002 50.102 Z" vector-effect="non-scaling-stroke"/></g></svg>
  
  <div id="matter-game"></div>
</template>

<script lang="ts" setup>
  import {
    Common,
    Engine,
    Render,
    Runner,
    Bodies,
    Svg,
    Vertices,
    Composite,
    MouseConstraint,
    Mouse,
  } from "matter-js";

  const props = defineProps<{
    width: number,
    height: number
  }>()
</script>

<script lang="ts">
  export default {
    methods: {
      getRandomInt(max: number): number {
        return Math.floor(Math.random() * max);
      },
      createSVG(pathID: string, numSamples: number ,x: number, y: number, color: string) {
        const path = document.getElementById(pathID) as unknown as SVGPathElement;
        let logoVertices = Svg.pathToVertices(path, numSamples);
        logoVertices = Vertices.scale(logoVertices, 3, 3, {x: 0, y: 0});

        return Bodies.fromVertices(
          x, y,
          [logoVertices],
          {
            isStatic: true,
            render: {
              fillStyle: color,
              strokeStyle: color,
              lineWidth: 3
            },
          },
          false,
          0.001,
          1
        );
      },
    },
    mounted() {
      const numObjects = 20;

      const primaryColor = '#DC5F00';
      const darkColor = '#373A40';
      const lightColor = '#EEEEEE';
      // const width = this.width;
      // const height = this.height;
      const width = window.innerWidth;
      const height = window.innerHeight - 50;

      var engine = Engine.create();
      var canvas = document.getElementById('matter-game')!;
      const renderOptions = {
        pixelRatio: 1,
        width: width,
        height: height,
        background: primaryColor,
        hasBounds: false,
        enabled: true,
        wireframes: false,
        showSleeping: true,
        showDebug: false,
        showBroadphase: false,
        showBounds: false,
        showVelocity: false,
        showCollisions: false,
        showSeparations: false,
        showAxes: false,
        showPositions: false,
        showAngleIndicator: false,
        showIds: false,
        showShadows: true,
        showVertexNumbers: false,
        showConvexHulls: false,
        showInternalEdges: false,
        showMousePosition: true
      }

      // create a renderer
      var render = Render.create({
          element: canvas,
          engine: engine,
          options: renderOptions,
      });

      var thickness = 100;

      var borderHeight = height * 1.25;
      var halfHeight = borderHeight / 2;
      var halfWidth = width / 2;
      var halfThickness = thickness / 2;

      // create bounds
      const boundOptions = {
        isStatic: true,
        render: {
          strokeStyle: primaryColor,
          lineWidth: 0,
        }
      };
      var bottomBound = Bodies.rectangle(
        halfWidth, 
        height + halfThickness, 
        width, 
        thickness, 
        boundOptions);
      var rightBound = Bodies.rectangle(
        width + halfThickness, 
        -halfHeight + height, 
        thickness, 
        borderHeight + (thickness * 2), 
        boundOptions);
      var topBound = Bodies.rectangle(
        halfWidth, 
        -halfThickness - borderHeight + height, 
        width, 
        thickness, 
        boundOptions);
      var leftBound = Bodies.rectangle(
        -halfThickness, 
        -halfHeight + height, 
        thickness, 
        borderHeight + (thickness * 2), 
        boundOptions);
      const boundBodies = [bottomBound, rightBound, topBound, leftBound]
      
      // create objects
      const bodyOptions = {
        render: {
          fillStyle: darkColor,
        },
        restitution: 0.8,
      };
      let objects = Array(numObjects)

      for (let i = 0; i < numObjects; i++) {
        let object;

        let randomX = this.getRandomInt(Math.min(Math.max(this.getRandomInt(width * 0.75) + 100, 100), width * 0.75));
        let randomY = -100 - this.getRandomInt(100);
        let randomSize = 75 + this.getRandomInt(50);

        switch(this.getRandomInt(3)) {
          case 0:
            object = Bodies.circle(randomX, randomY, randomSize / 2, bodyOptions);
            break;
          case 1:
            object = Bodies.polygon(randomX, randomY, 6, randomSize / 2, bodyOptions);
            break;
          case 2:
            object = Bodies.rectangle(randomX, randomY, randomSize, randomSize, bodyOptions);
            break;
        }

        objects[i] = object;
      }

      // TODO: create VGDC logo body
      const logoCenterX = width / 2;
      const logoCenterY = height / 2;

      const vBody = this.createSVG('path-v', 100, logoCenterX - 400, logoCenterY, lightColor);
      const gBody = this.createSVG('path-g', 4, logoCenterX - 150, logoCenterY, lightColor);
      const dBody = this.createSVG('path-d', 4, logoCenterX + 190, logoCenterY, lightColor);
      const cBody = this.createSVG('path-c', 4, logoCenterX + 400, logoCenterY, lightColor);
      const logoBodies = [vBody, gBody, dBody, cBody];

      // add all of the bodies to the world
      Composite.add(engine.world, [...logoBodies, ...objects, ...boundBodies]);

      // mouse interactivity
      var canvasMouse = Mouse.create(canvas);

      var mouseOptions = {
        mouse: canvasMouse,
        constraint: {
          stiffness: 0.5,
          render: {
            visible: false,
          },
        },
      };

      var mouseConstraint = MouseConstraint.create(engine, mouseOptions);
      Composite.add(engine.world, mouseConstraint)
      render.mouse = canvasMouse;

      // run matter js
      Render.run(render);
      var runner = Runner.create();
      Runner.run(runner, engine);

      // // resize event handler
      // function handleWindowResize() => {
      //   // get the current window size
      //   var width = this.width,
      //       height = document.documentElement.clientHeight;

      //   // set the render size to equal window size
      //   // @ts-ignore
      //   Render.setSize(render, width, height * 1.25);
      //   // @ts-ignore
      //   // Render.setPixelRatio(render, 'auto');

      //   // update the render bounds to fit the scene
      //   Render.lookAt(render, Composite.allBodies(engine.world), {x: -thickness, y:-thickness}, true);
      // };

      // // add window resize handler
      // window.addEventListener('resize', handleWindowResize);

      // // update canvas size to initial window size
      // handleWindowResize();

      // add scrolling to the canvas
      render.canvas.addEventListener('wheel', function(event) {
        event.preventDefault();
        
        window.scrollBy({
            top: event.deltaY,
            left: 0,
            behavior: 'auto'
        });
      }); 
    }
  };
</script>


<style scoped>
</style> => =>